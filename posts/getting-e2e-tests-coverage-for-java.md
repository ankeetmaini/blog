## Getting Code Coverage for e2e tests run on a Java codebase

I recently was asked to help on a project where they were trying to get the test coverage for **e2e tests** also known as **component tests**. As I come from a JavaScript/NodeJS background I initially tried to lean to the argument that component tests run on the actual application process and not in the context of a test/source file unlike a __unit test__.

The way a Java app runs is quite similar to a NodeJS app. A __bundle__ in Java world is called a __jar__. You can run an app by just running the jar file which contains all the classes and the app dependencies all together.

```bash
java -jar <application-code>.jar
```

That's it, the app server would start and you can run your component/e2e tests using any framework of your liking.

For simplicity I'd choose running manual curls and seeing if the api responds correctly or not. So here if you see we're not dealing with the testing framework's ability to generate code coverage, what we actually want is to see from the time we started our app what code paths were run.

### JaCoCo

This is the library which is used by all `Java` programmers to get coverage for their unit tests. It stands for **Java** **Co**de **Co**verage. (I could've never guessed it in my dreams had I not googled it). Usually people use it to generate the coverage for Unit tests but it also supports Runtime coverage.

### Runtime code coverage
This tells you what code is running once the app starts, which code paths are getting executed and how many times. This is done using a Java Instrumentation API which allows you to write a program which can add some instrumentation changes to the generated bytecode. It is commonly used to:

- profile apps, find the hot methods to see what's eating up your CPUs and taking a long time
- coverage - **the current use-case at hand**
- monitoring

All these methods require you to use a **Java Agent** which is attached to the code that you want to run. Below is an example on how you'd attach an agent to profile/monitor your code

```bash
java -javaagent:<your-monitoring-code>.jar -jar <application-code>.jar
```